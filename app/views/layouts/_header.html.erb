<nav class="navbar navbar-default navbar-fixed-top" id="header" >
    <div class="container-fluid" id="hederi">  
        <div id="tdhanat-45"><span onclick="doSomething()" style="cursor:pointer;">☰</span></div> 
        <div id="mySidenav" class="sidenav">
          <table>
            <tr>
              <td colspan=2 style="width: 185px">
                <a class="navside active" onclick="closeNav(); fade()" href="/"><span class="glyphicon glyphicon-home"></span></a>
              </td>
              <td style="width: 60px">
                <div><span style="font-size:30px;cursor:pointer; color: #c4c4c4; top: 50px" onclick="doSomething()"><center><span><strong>&#x2715;</strong></span></center></div>
              </td>
            </tr>
            <tr>
              <td colspan="2"><div class="navside"><a onclick="closeNav(); fade()" href="/autorizims/1">Autorizimi</a></div></td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/garancions">Garancionet</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/garancions/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/clients">Klientët</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/clients/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/imports">Importet</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/imports/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/import_search">&#8226; Kerko <i class="fa fa-search" aria-hidden="true"></i></a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/exports">Eksportet</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/exports/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/exportlandes">&#8226; Eksportet e Lendes se Pare</a></div>
              </td>
              <td style="width: 60px">
                <div  class="mininavplus"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/exportlandes/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/import_search">&#8226; Faturat</a></div>
              </td>
              <td style="width: 60px">
                <div  class="mininavplus"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/articles/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/products">Produktet</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/products/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/product_search">&#8226; Kerko <i class="fa fa-search" aria-hidden="true"></i></a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/articles">Artikujt</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/articles/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/article_search">&#8226; Kerko <i class="fa fa-search" aria-hidden="true"></i></a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/normatives">Normativat</a>
              </td>
              <td style="width: 60px">
                <div><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/normatives/new">+</a></div>
              </td>
            </tr>
            <tr>
              <td colspan=2 style="width: 185px">
                <div class="navside" style="white-space: nowrap"><a onclick="closeNav(); fade()" href="/reports">Reportet</a>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/specifikacions">&#8226; Specifikacionet</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/official">&#8226; Gjendja Zyrtare</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/gjendja">&#8226; Gjendja</a></div>
              </td>
            </tr>
            <tr>
              <td style="width: 15px">
              </td>
              <td style="width: 145px">
                <div class="mininav"><a onclick="closeNav(); fade()" style="margin-left: 25px" href="/mbetja">&#8226; Mbetja</a></div>
              </td>
            </tr>
          </table>
        </div>
        
        
        
        <center><div id="tit" style="display: inline-block; vertical-align: top;">
            <%= link_to 'Perpunimi Brendshem', root_path, id:"titulli", class:"mid" %>
        </div></center>
        
        
        <div class="tdhanat-2">
          <div ng-app="demoApp" class="ng-app">
        		<div class="wrapper" ng-controller="demoController">
        		  <div class="nav-bar">
        		    <ul>
        		      <li>
        		        <div class="dropdowns-wrapper">
        		          <div class="dropdown-container">
          		          <div class="dropdown">
                          <button class="dropbtn">
                            <div class="notifications dropdown dd-trigger" ng-click="showNotifications($event)" id="not-click">
            		              <span class="count animated" id="notifications-count"><%= $notifications %></span>
            		              <span class="fa fa-bell-o"></span>
            		            </div>
          		            </button>
                          <div class="dropdown-content">
                              <button class="dropdown-btn1" id="btn1">Legalet
                                  <i class="fa fa-caret-down"></i>
                              </button>
                              <button class="dropdown-btn2">Perpunimi
                                  <i class="fa fa-caret-down"></i>
                              </button>
                              <button class="dropdown-btn3">Gjendja
                                  <i class="fa fa-caret-down"></i>
                              </button>
                          </div>
                        </div>
        		            
        		            <div class="dropdown-menu animated" id="notification-dropdown">
        		              <div class="dropdown-header">
        		                <span class="triangle"></span>
        		                <span class="heading">Notifications</span>
        		                <span class="count" id="dd-notifications-count"><%= $notifications %></span>
        		              </div>
        		              <div class="dropdown-body">
        		                <div class="notification new" ng-repeat="notification in newNotifications.slice().reverse() track by notification.timestamp">
        		                  <div class="notification-image-wrapper">
        		                  	<div class="notification-image">
        			                  	<img src="" alt="" width="32">
        			                  </div>
        		                  </div>
        		                  <div class="notification-text">
        		                     <span class="highlight">Helo</span>
        		                  </div>
        		                </div>
        		                <div class="notification" ng-repeat="notification in readNotifications.slice().reverse() track by $index">
        		                  <div class="notification-image-wrapper">
        		                  	<div class="notification-image">
        			                  	<img src="" alt="" width="32">
        			                  </div>
        		                  </div>
        		                  <div class="notification-text">
        		                     <span class="highlight">3</span>
        		                  </div>
        		                </div>
        		              </div>
        		            </div>
        		          </div>
        		      </li>
        		    </ul>  
        		  </div>
        		</div>
        	</div>
        </div>
        
        <div id="tdhanat-3">
          <%= image_tag kompania.image_url(:icon).to_s, style: "border-radius: 50%;" %>
        </div>
        <div id="tdhanat-34">
          <% if (current_user.first_name + current_user.last_name.first).length < 10 %>
            <p><%= link_to "#{current_user.first_name.capitalize} #{current_user.last_name.first.capitalize}", current_user, style: "text-decoration: none; color: white" %></p>
          <% else %>
            <p><%= link_to "#{current_user.first_name.first.capitalize}. #{current_user.last_name.first.capitalize}.", current_user, style: "text-decoration: none; color: white" %></p>
          <% end %>
        </div>
        <div id="tdhanat-4"><span onclick="doSomethingRight()" style="cursor:pointer;"><%= image_tag "gear.svg", style: "height: 23.11px; width: 20.99px" %></span></div>
        
        <div id="mySidenavRight" class="sidenavright" style="border-left: 0.5px solid #f3f3f3;">
            <div class="top-side" id="top-sidi">
              <div style="display:inline-block; heigth: 64px;"><p style="margin-top: 20px; font-size: 15px; margin-left: 20px; color: white">Rregullimet</p></div>
              <div style="display:inline-block; height: 64px; position: absolute; right: 35px; top: 20.945px; margin-left: 120px;"><span onclick="doSomethingRight()" style="cursor:pointer;"><div style="height: 23.11px; width: 23.11px; background: #343b4a; border-radius: 50%; color: white; font-size: 11.5px; padding-top: 3.5px; padding-left: 6.5px"><span><strong>&#x2715;</strong></span></div></div>
            </div>
            <div class="side-photo">
              <center><%= image_tag kompania.image_url(:thumber).to_s %></center>
              <center><h5 style="font-family: Barlow; color: #414D5F"><strong><%= kompania.kompania %></strong></h5></center>
              
              <center><h6 style="font-family: Barlow; color: #414D5F"><%= current_user.first_name.capitalize %> <%= current_user.last_name.capitalize %></h6></center>
            </div>
            <div style="border-top: 0.5px solid #f3f3f3; border-bottom: 0.5px solid #f3f3f3">
              <center><div style="display:inline-block; height: 35px; "><p style="font-size: 15px; color: #6C757D; margin-top: 7px"><strong>Rregullimet Kryesore</strong></p></div></center>
            </div>
            <div style="margin-top: 25px;"></div>
            <table>
              <tr>
                <td width="185px">
                  <div class="navsideright"><a onclick="closeNavRight(); fade()" href="/kompanis/1/edit">Kompania</a></div>
                </td>
                <td width="60px">
                  
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><a onclick="closeNavRight(); fade()" href="/users">Përdoruesit</a></div>
                </td>
                <td width="60px">
                  <div><a onclick="closeNavRight(); fade()" style="margin-left: 25px" href="/users/new">+</a></div>
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><a onclick="closeNavRight(); fade()" href="/doganas">Zyret Doganore</a></div>
                </td>
                <td width="60px">
                  <div><a onclick="closeNavRight(); fade()" style="margin-left: 25px" href="/doganas/new">+</a></div>
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><a onclick="closeNavRight(); fade()" href="/doganas">Zyret e Destinimit</a></div>
                </td>
                <td width="60px">
                  <div><a onclick="closeNavRight(); fade()" style="margin-left: 25px" href="/destinims/new">+</a></div>
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><a onclick="closeNavRight(); fade()" href="/doganas">Njësitë</a></div>
                </td>
                <td width="60px">
                  <div><a onclick="closeNavRight(); fade()" style="margin-left: 25px" href="/njesis/new">+</a></div>
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><a onclick="closeNavRight(); fade()" href="/users/<%= current_user.id %>/change_date">Lajmërimet</a></div>
                </td>
                <td width="60px">
                </td>
              </tr>
              <tr>
                <td width="185px">
                  <div class="navsideright" style="white-space: nowrap"><%= link_to ("Log Out"), logout_path, {method: "delete", 'onclick' => 'closeNavRight'} %></div>
                </td>
                <td width="60px">
                  <div class="navsideright" style="white-space: nowrap"><%= link_to (image_tag 'mbyllja.svg', style: "width:1.4vw;padding-bottom:3px;padding-right:3px"), logout_path, {method: "delete", 'onclick' => 'closeNavRight'} %></div>
                </td>
              </tr>
            </table>
        </div>
    </div>
</nav>
<script>
  var clicked = false;
  function openNav() {
    document.getElementById("mySidenav").style.width = "250px";
    $("#mySidenav").fadeTo("fast",0.9);
    clicked=true;
    $("#tdhanat-45").fadeTo("fast",0);
    for (var i=0; i < elements.length; i++) {
      elements[i].fadeTo("fast", 1);
    }
  }
  function closeNav() {
    document.getElementById("mySidenav").style.width = "0px";
    $("#mySidenav").fadeTo("fast",1);
    clicked=false;
    $("#tdhanat-45").fadeTo("fast",1);
    for (var i=0; i < elements.length; i++) {
      elements[i].fadeTo("fast", 0.5);
    }
  }
  
  function doSomething() {
    if(!clicked) {
      openNav(); 
    } else {
     closeNav(); 
    }
  }
  
  var clickedRight = false;
  function openNavRight() {
    document.getElementById("mySidenavRight").style.width = "250px";
    clickedRight=true;
  }
  function closeNavRight() {
    document.getElementById("mySidenavRight").style.width = "0px";
    clickedRight=false;
  }
  
  function doSomethingRight() {
    if(!clickedRight) {
      openNavRight(); 
    } else {
     closeNavRight(); 
    }
  }
  // <=============>
  // <=============>
  // <=============>
  // <=============>
  // <=============>
  var app = angular.module('demoApp', ['ngAnimate']);
  app.controller('demoController', function($scope){
  	var opendd;
  	var storedNewNotifications;
  	var storedReadNotifications;
  	var storedawaitingNotifications;
  	var init = function(){
  		storedNewNotifications = JSON.parse(localStorage.getItem('newNotifications'));
  		storedReadNotifications = JSON.parse(localStorage.getItem('readNotifications'));
  		storedawaitingNotifications = JSON.parse(localStorage.getItem('awaitingNotifications'));
  		if(storedNewNotifications == null){
  			$scope.newNotifications = [
  				{
  					user: pollingData.users[1],
  					action: pollingData.actions[0],
  					target: pollingData.actionTargets[2],
  					timestamp: new Date()
  				}
  			];
  		}
  		else{
  			$scope.newNotifications = storedNewNotifications;
  		}
  		if(storedReadNotifications == null){
  			$scope.readNotifications = [
  				{
  					user: pollingData.users[2],
  					action: pollingData.actions[1],
  					target: pollingData.actionTargets[0],
  					timestamp: new Date()
  				}
  			];
  		}
  		else{
  			$scope.readNotifications = storedReadNotifications;
  		}
  		if(storedawaitingNotifications == null)
  			$scope.awaitingNotifications = 1;
  		else{
  			$scope.awaitingNotifications = storedawaitingNotifications;
  			if($scope.awaitingNotifications == 0)
  				angular.element('#notifications-count').hide();
  		}
  		$scope.showNotifications = function($event){
  			var targetdd = angular.element($event.target).closest('.dropdown-container').find('.dropdown-menu');
  			opendd = targetdd;
  		    if(targetdd.hasClass('fadeInDown')){
  		    	hidedd(targetdd);
  		    }
  		    else{
  		    	targetdd.css('display', 'block').removeClass('fadeOutUp').addClass('fadeInDown')
  		    									.on('animationend webkitAnimationEnd oanimationend MSAnimationEnd', function(){
  	  												angular.element(this).show();
  	  											});
            targetdd.find('.dropdown-body')[0].scrollTop = 0;
  		    	$scope.awaitingNotifications = 0;
  		      	angular.element('#notifications-count').removeClass('fadeIn').addClass('fadeOut');
  		    }
  		};
  		$scope.hideInfo = function(){
  			angular.element('#demoInfo').addClass('zoomOut')
  										.on('animationend webkitAnimationEnd oanimationend MSAnimationEnd', function(){
  											angular.element(this).hide();
  											angular.element('.instruction').addClass('zoomIn').show();
  										});
  		}
  		//show notifications count if new notifications are received
  		setInterval(function(){
  			if($scope.awaitingNotifications > 0 && opendd == null && (angular.element('#notifications-count').css('opacity') == '0' || angular.element('#notifications-count').is(':hidden')))
      			angular.element('#notifications-count').removeClass('fadeOut').addClass('fadeIn').show();
  		}, 400);
  		dummyPolling();
  	}
  
  	//Hide dropdown function
  	var hidedd = function(targetdd){
  		targetdd.removeClass('fadeInDown').addClass('fadeOutUp')
  										  .on('animationend webkitAnimationEnd oanimationend MSAnimationEnd', function(){
    												angular.element(this).hide();
    											});
      	opendd = null;
      	$scope.awaitingNotifications = 0;
      	angular.forEach($scope.newNotifications, function(notification){
      		$scope.readNotifications.push(notification);
      	});
      	$scope.newNotifications = [];
      	localStorage.setItem('readNotifications', JSON.stringify($scope.readNotifications));
      	localStorage.setItem('newNotifications', JSON.stringify($scope.newNotifications));
  		localStorage.setItem('awaitingNotifications', JSON.stringify($scope.awaitingNotifications));
      	if($scope.awaitingNotifications > 0)
      		angular.element('#notifications-count').removeClass('fadeOut').addClass('fadeIn');
  	}
  
  	$("#not-click").onclick = function(event){
  		var clickedElement = angular.element(event.target);
  		var clickedDdTrigger = clickedElement.closest('.dd-trigger').length;
  		var clickedDdContainer = clickedElement.closest('.dropdown-menu').length;
  		if(opendd != null && clickedDdTrigger == 0 && clickedDdContainer == 0){
  			hidedd(opendd);
  		}
  	}
    
    window.onbeforeunload = function(e) {
  	  if(opendd != null){
        console.log('closingdd');
        hidedd(opendd); 
      }
  	};
  
  	init();
  })
</script>